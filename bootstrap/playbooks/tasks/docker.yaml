---
# Note, for nested dockers we use the daemon and storage of the host container.
# So, there is no need to start docker daemon and pull images at build time
- shell: docker --version
  ignore_errors: true
  register: docker_version
- shell: curl -sSL https://get.docker.com/ | sudo sh
  when: docker_version | failed

# pre download riak image
- shell: docker pull solarproject/riak
  when: lookup('env', 'DOCKER_NESTED') == "false"

# prebuild pg container
- git: repo=https://github.com/kiasaki/docker-alpine-postgres.git dest=/tmp/docker-alpine-postgres update=yes
- shell: make build
  args:
    chdir: /tmp/docker-alpine-postgres
- shell: rm -fr /tmp/docker-alpine-postgres
